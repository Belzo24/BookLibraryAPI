{% extends 'base.html' %}
{% block title %}Authors | Book Library{% endblock %}
{% block content %}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-messages">
      {% for category, message in messages %}
        <div class="flash flash-{{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}
<h2>Authors</h2>
<div class="form-section">
    <form id="addAuthorForm" method="post">
        <input type="text" id="author_input" name="author_input" placeholder="Enter Author name" required>
        <input type="text" id="birth" name="birth" placeholder="Enter Author's birthdate" required>
        <button type="submit" class="btn fun-btn" name="action" value="submit">Add Author</button>
    </form>
</div>
<table id="authorsTable">
    <thead>
        <tr>
            <th>Author</th>
            <th>ID</th>
            <th>Birthdate</th>
            <th>Update</th>
            <th>Remove</th>
        </tr>
    </thead>
    <tbody>
        {% for item in Authors %}
        <tr data-id="{{ item.author_id }}">
            <td class="author-name">{{ item.author_name }}</td>
            <td class="author-id">{{ item.author_id }}</td>
            <td class="author-birth">{{ item.birth }}</td>
            <td>
                <button class="btn edit-btn" onclick="editRow(this)">Update</button>
                <form action="/home/author/update/" method="POST" class="update-form" style="display:none;">
                    <input type="hidden" name="update" value="{{ item.author_id }}">
                    <input type="text" name="author_name" value="{{ item.author_name }}" required>
                    <input type="text" name="birth" value="{{ item.birth }}" required>
                    <button type="submit" class="btn save-btn">Save</button>
                    <button type="button" class="btn cancel-btn" onclick="cancelEdit(this)">Cancel</button>
                </form>
            </td>
            <td>
                <form action="/home/author/remove/" method="POST">
                    <input type="hidden" name="author_id" value="{{ item.author_id }}">
                    <button type="submit" class="btn cancel-btn" name="unalive" value="true">Remove</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
{% block scripts %}
<script>
function editRow(btn) {
    const row = btn.closest('tr');
    row.classList.add('editable-row');
    btn.style.display = 'none';
    row.querySelector('.update-form').style.display = 'inline-block';
}
function cancelEdit(btn) {
    const form = btn.closest('.update-form');
    const row = form.closest('tr');
    row.classList.remove('editable-row');
    row.querySelector('.edit-btn').style.display = 'inline-block';
    form.style.display = 'none';
}
</script>
{% endblock %} 